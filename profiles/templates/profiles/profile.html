{% extends "base.html" %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static '/css/profiles.css' %}">
{% endblock %}

{% block page_header %}
<div class="container header-container">
    <div class="row justify-content-center">
        <div class="col">
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="overlay"></div>
<div class="container px-lg-5">
    <div class="row">
        <div class="col">
                <h2 class="title-text my-1 text-left">
                    My Account
                </h2>
            <hr>
        </div>
    </div>
    {% if request.user.is_authenticated %}
    {% include 'profiles/inlcudes/logged_in_row.html' %}
    <div class="row">
        <div class="col-12">
            <h2 class="my-2 title-text text-left">
                <small>Current Details Summary</small>
            </h2>
            <hr>
        </div>
        <div class="col-6 text-left">
            <p><span class="text-muted"> <i class="fas fa-envelope-open-text"></i> Buyer email:</span> {{ profile.buyer_email }}</p>
            <p><span class="text-muted"><i class="fas fa-envelope-open-text"></i> Accounts email: </span>{{ profile.buyer_email }}</p>
        </div>
        <div class="col-6 text-right">
            <p><span class="text-muted"><i class="far fa-address-book"></i> Address: </span></p>
            <p class="p-0 m-0">{{ profile.address_1 }}</p>
            <p class="p-0 m-0">{{ profile.town_or_city }}</p>
            <p class="p-0 m-0">{{ profile.county_or_state }}</p>
            <p class="p-0 m-0">{{ profile.postcode }}</p>
            <p class="p-0 m-0">{{ profile.country }}</p>

        </div>
        
        
    </div>
    
    <main class="row pb-3">

            <!-- Profile Details  -->
        

        <section class="col-sm-12 col-md-6 mt-3 mb-3 text-right details-section">
            <hr>
            <p><span><i class="fas fa-user-edit"></i> Update Details</span></p>
            <button type="button" class="profile-details-open">
                <i class="fas fa-chevron-circle-down"></i>
            </button>
            <div class="col-12 profile-details text-right" style="display:none;">

                    <!-- Profile Update Form -->

                
                <form action="{% url 'profile' %}" method="POST" class="mt-3" id="profile-update-form">
                    {% csrf_token %}
                    {{ form|crispy }}
                    <button class="btn btn-affirmative float-right"><i class="fas fa-user-edit"></i> Update Details</button>
                </form>
            </div>
        </section>

            <!-- Order History  -->
        

        <section class="col-sm-12 col-md-6 mt-md-3 mb-3 text-right history-section">
            <hr>
            <p><span><i class="fas fa-clipboard-list"></span></i> Order History</p>
            <button type="button" class="order-history-open">
                <i class="fas fa-chevron-circle-down"></i>
            </button>
            <div class="col-12 order-history table-responsive"  style="display:none;">
                <div class="table table-borderless">
                    <table>
                    <thead>
                        <tr>
                            <th>Order Number</th>
                            <th>Date Ordered </th>
                            <th>Delivery Date</th>
                            <th>Quantity</th>
                            <th>Order Total</th>
                        </tr>
                    </thead>
                    
                        {% for order in orders %}
                        <tr>
                            <td>
                                 <a class="nav-link" href="{% url 'order_history' order.order_number %}" title="{{ order.order_number|truncatechars:6 }}">
                                    {{ order.order_number|truncatechars:6 }}  
                                </a>
                                
                            </td>
                            <td>{{ order.date }}
                            </td>

                            <td>{{ order.delivery_date }}</td>
                            <td>{{ order.total_items }}</td>
                            <td>Â£ {{ order.grand_total }}</td>
                        </tr>
                        {% endfor %}
                    </table>

                </div>
            </div>
        </section>
        <section class="container categories">
            <div class="row row-cols-1 row-cols-md-3">
            {% for category in categories %}
                {% if category.name in permissions_list %}
                <div class="col mb-4">
                    <div class="card text-white category-image">
                        <a href="{% url 'collections' %}?chosen_categories={{ category.name }}">
                        <img src="/media/{{ category.name }}.jpeg" class="card-img" alt="category {{ category.name }}">
                        <div class="card-img-overlay">
                        <h4 class="card-title category-card-title title-text text-right">Shop {{ category.name }}</h4>
                        
                        </div>
                        </a>
                    </div>
                </div>
               
                {% endif %}
            
            {% endfor %}
            <div class="col mb-4">
                <div class="card text-white">
                    <a href="{% url 'collections' %}" class="category-title-link">
                    <img src="/media/shop_all.jpeg" class="card-img" alt="category all">
                    <div class="card-img-overlay">
                    <h4 class="card-title category-card-title title-text text-right">Shop All</h4>
                    
                    </div>
                    </a>
                </div>
            </div>
            </div>
        </section>
    </main>
    {% endif %}  
</div>
{% endblock %}

{% block postloadjs %}
    {{ block.super }}
    {% include 'products/includes/details_display.html' %}
{% endblock %}